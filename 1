
LnkLtr.linkModule = (function(){

	var module = {};
  var rowContainer = $('.links-container-wrapper');
	var rowTmpl = $('#row-template');
  var linksContainer = $('.links-container');


	module.getLastRow = function(linksContainer){
		return linksContainer.last();
	}

	module.addToRow = function(row, item){
		return $(row).append(item);
	}

	module.compileTemplate = function(tmpl){
		return Handlebars.compile($(tmpl).html());
	}

	// TODO implement singleton pattern
	module.getNewRow = function(rowTmpl){
		return module.compileTemplate(rowTmpl)();
	}

	// TODO implement singleton pattern
	module.getNewLink = function(linkTmpl, context){
		var tmpl = module.compileTemplate(linkTmpl);
		return tmpl(context);
	}

	module.getLinkInRow = function(row){
		return row.find('.link-item');
	}

	module.addNewRow = function(link){
		rowContainer.append(module.addToRow(module.getNewRow(rowTmpl), link));
	}

	module.addNewLink = function(linkObj){
		var linksContainer = $('.row.links-container');
    var linkItemTmpl = $('#link-template');
		var lastRow = module.getLastRow(linksContainer);
    var link = module.getNewLink(linkItemTmpl, linkObj);
		if(lastRow.length > 0 && module.getLinkInRow(lastRow).length < 3 ){
			module.addToRow(lastRow, link);
		}else{
			module.addNewRow(link);
			//lastRow.after(addToRow(getNewRow(rowTmpl), link));
		}
	}

  module.addPreviewLink = function(linkObbj){
    var linkItemTmpl = $('#link-template');
    var link = module.getNewLink(linkItemTmpl, linkObj);
    console.log('testing preview link template', link);
  }

  module.displayList = function(list){
    console.log('From displayList>>> ', list);
    var linkItemTmpl = $('#link-template');
    $.each(list, function(idx, obj){
      module.addNewLink(obj);
    });
  }
	return module;
})();
